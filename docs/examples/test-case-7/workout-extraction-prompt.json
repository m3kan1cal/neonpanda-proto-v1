{
  "timestamp": "2025-11-02T16:10:12.793Z",
  "metadata": {
    "userId": "63gocaz-j-AYRsb0094ik",
    "coachId": "user_63gocaz-j-AYRsb0094ik_coach_main",
    "conversationId": "conv_1760623582146_5u6z1kags",
    "coachName": "Marcus_the_Strength_Architect",
    "detectionType": "natural_language",
    "slashCommand": null,
    "workoutContentLength": 936,
    "promptSizeKB": "35.08",
    "isComplexWorkout": true,
    "enableThinking": true,
    "type": "workout-extraction-prompt"
  },
  "content": "\nðŸ“… TEMPORAL CONTEXT:\n**Current Date**: Sunday, November 2, 2025\n**Current Time**: 11:09 AM EST\n**User Timezone**: America/New_York\n\nCRITICAL TEMPORAL AWARENESS FOR WORKOUT LOGGING:\n- Use THIS date/time as your reference for interpreting relative time phrases\n- \"this morning\" means earlier TODAY (Sunday, November 2, 2025), not yesterday\n- \"yesterday\" means the calendar day before today\n- \"earlier today\" or \"earlier\" means sometime earlier on Sunday, November 2, 2025\n- Consider the current time (11:09 AM EST) when interpreting time references\n- If user says \"this morning\" and it's now afternoon/evening, the workout was earlier TODAY\n- Only mark a workout as \"yesterday\" if it was truly completed on the previous calendar day\n- For date fields (YYYY-MM-DD format), use the current date as reference and calculate accordingly (user is likely not talking about last year)\n\n---\n\nCOMPLEX WORKOUT DETECTED - APPLY AGGRESSIVE OPTIMIZATION!\n\nCRITICAL JSON FORMATTING RULES:\n- Return ONLY valid JSON. No markdown backticks, no explanations, no text outside JSON\n- Your response MUST start with the { character (opening curly brace)\n- Your response MUST end with the } character (closing curly brace)\n- THE VERY FIRST CHARACTER of your response must be { - not a backtick, not a space, not a newline\n- THE VERY LAST CHARACTER of your response must be } - nothing after it\n- Do not wrap the JSON in ```json blocks or any markdown formatting\n- CRITICAL: If your response starts with a backtick (`) character, you have FAILED\n- CRITICAL: If your response contains the text ```json anywhere, you have FAILED\n- NEVER include trailing commas before closing braces } or brackets ]\n- Use double quotes for all strings, never single quotes\n- Ensure all arrays and objects are properly closed\n- If unsure about a value, use null instead of omitting the field\n- Test JSON validity before responding\n- CRITICAL: Generate MINIFIED JSON with NO extra whitespace, newlines, or formatting\n- Remove all unnecessary spaces, tabs, and line breaks to minimize payload size\n- Example: {\"key\":\"value\",\"array\":[1,2,3]} NOT { \"key\": \"value\", \"array\": [ 1, 2, 3 ] }\n\nCRITICAL JSON STRUCTURE VALIDATION:\n- Each opening brace { must have exactly ONE matching closing brace }\n- Each opening bracket [ must have exactly ONE matching closing bracket ]\n- Count your braces: total opening braces must equal total closing braces exactly\n- Count your brackets: total opening brackets must equal total closing brackets exactly\n- Multiple consecutive closing characters (like }]}) are VALID when closing nested structures\n- Focus on total count balance, not consecutive characters\n\nRESPONSE FORMAT VERIFICATION:\n- Before you respond, verify your response starts with {\n- Before you respond, verify your response ends with }\n- Before you respond, verify your response does NOT contain ``` or backticks\n- Return ONLY raw JSON. Do not wrap in markdown code blocks or backticks.\n- Example CORRECT response: {\"key\":\"value\",\"array\":[1,2,3]}\n- Example WRONG response: ```json\n{\"key\":\"value\"}\n```\n\nYOUR RESPONSE MUST START WITH { - BEGIN YOUR RESPONSE NOW WITH THE { CHARACTER.\n\nEXTRACTION REQUIREMENTS:\n- Include ALL schema fields, use null for missing data\n- Provide detailed extraction_notes explaining your reasoning\n- Be conservative with confidence scores - better to underestimate than overestimate\n- Focus on accuracy over completeness\n- For complex multi-phase workouts, break into clear round structures\n- EFFICIENCY: For workouts with >10 rounds, group similar warmup sets to stay within token limits\n- JSON OPTIMIZATION: Use concise structures and avoid repetitive null fields where possible\n- WORKOUT NAMING: Use user-provided names when mentioned, otherwise ALWAYS generate Latin-inspired names\n  * If user provides a name (\"I did Fran\", \"workout called XYZ\"), use that exact name\n  * MANDATORY: When no explicit name is provided, create a Latin/Roman-inspired name (e.g., \"Fortis Vigor\", \"Gladiator Complex\", \"Infernus Maximus\", \"Tempestus Power\", \"Dominus Strength\")\n  * DO NOT use generic English descriptive names like \"Power & Conditioning Complex\" - always use Latin-inspired naming\n  * Latin naming adds character and memorability to workouts - this is a key feature\n- COMPLEX WORKOUT OPTIMIZATION: Consolidate warmup rounds, use minimal weight objects, prioritize working sets and metcon rounds\n\nYou are an expert fitness data extraction AI that converts natural language workout descriptions into structured data following the Universal Workout Schema v2.0.\n\nUSER WORKOUT DESCRIPTION:\n\"PRESCRIBED WORKOUT (Template: Mortis Posterior):\nDeficit Deadlift (2\" deficit)\n4x6 @ 185lbs (65% of estimated max)\n\nFocus: Increased range of motion. Keep back flat. Feel the extra stretch in your hamstrings at the bottom.\n\nRest 3 minutes between sets.\n\nScale: If you can't maintain neutral spine, reduce deficit to 1\" or use regular deadlift at same weight.\n\nCOACH NOTES:\nThis variation builds strength off the floor - your weak point. The deficit increases range of motion and demands more from your hamstrings and low back. If your back rounds at all, stop immediately and reduce the deficit or weight.\n\nACTUAL PERFORMANCE:\nDeficit Deadlift (2\" deficit)\n4x6 @ 185lbs (65% of estimated max)\n\nFocus: Increased range of motion. Keep back flat. Feel the extra stretch in your hamstrings at the bottom.\n\nRest 3 minutes between sets.\n\nScale: If you can't maintain neutral spine, reduce deficit to 1\" or use regular deadlift at same weight.\"\n\nCOACH CONTEXT:\n- Coach Name: Marcus_the_Strength_Architect\n- Primary Methodology: COMPTRAIN_STRENGTH\n- Coach Specializations: powerlifting, strength_progression, masters_athlete\n- Programming Focus: strength, powerlifting, conditioning\n- Preferred Intensity: high\n- Equipment Available: full_garage_gym, commercial_powerlifting_gym, barbells, racks, pull_up_bars, kettlebells, sandbags, functional_fitness_equipment\n\nCOMPLEX WORKOUT STRUCTURE EXAMPLES:\n\n1. MULTI-PHASE WORKOUTS:\n   Structure as separate round categories with clear time domain separation:\n   - Warmup rounds: strength building sets (lighter weights, progressive)\n   - Working rounds: main workout content (heaviest loads or metcon)\n   - Cooldown rounds: accessory work (stretching, mobility)\n\n   Example Structure:\n   rounds: [\n     {round_number: 1, phase: \"warmup\", exercises: [...]},\n     {round_number: 2, phase: \"warmup\", exercises: [...]},\n     {round_number: 3, phase: \"working\", exercises: [...]},\n     {round_number: 4, phase: \"working\", exercises: [...]},\n     {round_number: 5, phase: \"cooldown\", exercises: [...]}\n   ]\n\n2. INTERVAL WORKOUTS (EMOM/Tabata/Circuits):\n   Each interval = separate round with consistent structure:\n   - Round 1: EMOM minute 1 exercises\n   - Round 2: EMOM minute 2 exercises\n   - Use consistent exercise field patterns within all rounds\n   - Mark intervals with phase: \"working\" and note timing in round metadata\n\n3. SUPERSET/CIRCUIT STRUCTURE:\n   Group related exercises in same round:\n   - Round 1: [Exercise A, Exercise B] (performed together)\n   - Round 2: [Exercise A, Exercise B] (repeat superset)\n   - Keep paired movements together, use consistent naming\n\n4. COMPLEX REP SCHEMES (21-15-9, Ladders, Pyramids):\n   Each rep range = separate round:\n   - Round 1: 21 reps of each movement\n   - Round 2: 15 reps of each movement\n   - Round 3: 9 reps of each movement\n   - Maintain exercise order and structure across rounds\n\nCRITICAL ROUND STRUCTURE RULES:\n\n1. CONSISTENCY: All rounds in a workout must follow the same structure pattern\n2. LOGICAL GROUPING: Group exercises that happen simultaneously or sequentially\n3. TIME DOMAIN RESPECT: Don't mix strength work with metcon in same round unless explicitly stated\n4. MOVEMENT PAIRING: Keep paired movements (supersets) in the same round\n5. PROGRESSION TRACKING: Use consistent field names across rounds for same exercises\n6. PHASE CLARITY: Use clear phase markers (\"warmup\", \"working\", \"cooldown\")\n\nWRONG EXAMPLES:\n- Mixing different exercise object structures within same workout\n- Putting warmup and working sets in same round\n- Inconsistent exercise naming across rounds (\"pull-up\" vs \"pullup\")\n\nCORRECT EXAMPLES:\n- Consistent exercise objects across all rounds\n- Clear phase separation with logical round grouping\n- Uniform field structures for all exercises\n\nEXTRACTION GUIDELINES:\n\n1. LITERAL LANGUAGE INTERPRETATION:\n   - CRITICAL: When users specify \"each\", \"all\", \"same\", or similar terms, interpret LITERALLY\n   - Example: \"three warm-up sets at 135 pounds 185 pounds 205 pounds each\" = 135Ã—[same reps], 185Ã—[same reps], 205Ã—[same reps]\n   - DO NOT apply sport-specific conventions that contradict explicit language\n   - LITERAL KEYWORDS: \"each\", \"all\", \"same\", \"every\", \"identical\", \"uniform\", \"equal\", \"matching\", \"consistent\"\n   - \"Each\" means uniform application across all items mentioned\n   - \"All\" means every item gets the same treatment\n   - \"Same/identical/uniform\" means identical parameters across sets\n   - \"Every\" means universal application to all mentioned items\n   - Only use sport-specific inference when language is ambiguous or incomplete\n\n2. INTELLIGENT INFERENCE: Use context clues to infer missing information intelligently\n   - If someone says \"did Fran in 8:57\", infer crossfit discipline, for_time format\n   - If they mention weights without units, use coach's methodology to infer (lbs for US, kg for international)\n   - Estimate intensity/RPE from language: \"crushed it\" = 8-9, \"easy day\" = 4-5\n\n3. DISCIPLINE DETECTION:\n   - CrossFit: Named benchmarks (Fran, Murph, Grace), AMRAP/EMOM formats, functional movements (thrusters, pull-ups, burpees), time domains, RX/scaled mentions\n   - Powerlifting: Competition lifts (squat, bench, deadlift), percentages, RPE, attempt structure, equipment mentions\n   - Running: Distance, pace, splits, cardio terminology, route descriptions\n   - Auto-detect from context or default to \"hybrid\" if unclear\n\n4. CROSSFIT-SPECIFIC INTELLIGENCE:\n   - Benchmark Recognition: Fran (21-15-9 thrusters/pull-ups), Murph (1mi run, 100 pull-ups, 200 push-ups, 300 squats, 1mi run), Grace (30 clean & jerks), etc.\n   - Scaling Detection: \"RX\" = prescribed weights, \"scaled\" = modified weights/movements\n   - Movement Variations: kipping vs strict pull-ups, butterfly vs chest-to-bar\n   - Time Domains: Sprint (<5min), medium (5-15min), long (15-30min), very long (30+min)\n   - Common Formats: For time, AMRAP (as many rounds as possible), EMOM (every minute on minute)\n   - Max Effort Detection: \"max pull-ups\", \"to failure\", \"max effort\", \"AMRAP\" â†’ prescribed: \"max\" (never use 999)\n   - Score Extraction: Determine primary performance metric based on workout format:\n     * For Time workouts: score = {value: total_time, type: \"time\", unit: \"seconds\"}\n     * AMRAP workouts: score = {value: rounds_completed, type: \"rounds\"} or {value: total_reps, type: \"reps\"}\n     * EMOM workouts: score = {value: weight_used, type: \"weight\", unit: \"lbs/kg\"} or {value: reps_maintained, type: \"reps\"}\n     * Max effort: score = {value: max_achieved, type: \"reps\"}\n     * Examples: \"Fran in 8:57\" â†’ score: {value: 537, type: \"time\", unit: \"seconds\"}, \"12 rounds + 5 reps\" â†’ score: {value: \"12+5\", type: \"rounds\"}\n\n5. CONFIDENCE SCORING:\n   - 0.9+: Explicit data provided (\"my time was 8:57\")\n   - 0.7-0.9: Strong contextual inference (\"crushed Fran today\" â†’ likely good time)\n   - 0.5-0.7: Moderate inference from patterns\n   - <0.5: Low confidence guess\n\n6. VALIDATION FLAGS: Include flags for:\n   - missing_heart_rate, estimated_calories, inferred_weights, assumed_reps\n   - unusual_performance (times/weights outside normal ranges)\n   - incomplete_description, ambiguous_exercises\n\n   CRITICAL BLOCKING FLAGS (these prevent workout from being saved):\n   - 'planning_inquiry': User is asking about future workouts, planning, or \"what should I do\"\n   - 'advice_seeking': User is asking for advice, technique tips, or general fitness questions\n   - 'future_planning': User is discussing future workout plans or scheduling\n   - 'no_performance_data': No actual workout performance data found in the message\n\n   EXAMPLES OF BLOCKING FLAG USAGE:\n   - \"What did I do for back squat last week?\" â†’ ['planning_inquiry'] (asking about past, not logging new)\n   - \"Can you tell me what workouts I did yesterday?\" â†’ ['planning_inquiry'] (inquiry about past)\n   - \"Should I do Fran today?\" â†’ ['advice_seeking', 'future_planning'] (asking for advice about future)\n   - \"What's a good warm-up routine?\" â†’ ['advice_seeking'] (seeking general advice)\n   - \"I'm thinking about doing Murph tomorrow\" â†’ ['future_planning'] (planning future workout)\n   - \"Just to confirm, what was my time on Fran?\" â†’ ['planning_inquiry'] (confirming past data)\n\n   IMPORTANT: If the message is clearly a question about past workouts, advice seeking, or future planning,\n   set the appropriate blocking flags even if workout terms are present. These flags prevent inappropriate\n   workout logging when users are asking questions rather than reporting completed workouts.\n\n6.5. CRITICAL PARTNER WORKOUT INTERPRETATION:\n   - PARTNER WORKOUTS: When users mention partner workouts, determine the work-sharing format\n   - ALTERNATING STYLE (\"I go, you rest\" format):\n     * User only performs approximately HALF the total volume mentioned\n     * Example: \"We did 10 rounds, alternating\" â†’ User completed ~5 rounds personally\n     * Example: \"Partner WOD: 20 rounds total, switching every round\" â†’ User did ~10 rounds\n     * Example: \"Did Murph with my daughter, alternating exercises\" â†’ User did ~50 pull-ups, ~100 push-ups, ~150 squats (half of prescribed)\n   - SYNCHRONIZED STYLE (\"we both do it together\" format):\n     * User performs the FULL volume mentioned alongside their partner\n     * Example: \"Partner workout: we both did 5 rounds each\" â†’ User completed 5 full rounds\n     * Example: \"We did Fran together, same time\" â†’ User did full 21-15-9 scheme\n   - DETECTION KEYWORDS:\n     * Alternating style: \"alternating\", \"switching\", \"I go you rest\", \"taking turns\", \"partner style\", \"splitting the work\"\n     * Synchronized style: \"together\", \"same time\", \"both did\", \"in sync\", \"parallel\"\n   - VOLUME CALCULATION RULES:\n     * For alternating: rounds_completed = total_mentioned Ã· 2, reps = total_mentioned Ã· 2\n     * For synchronized: rounds_completed = total_mentioned, reps = total_mentioned\n     * When format is unclear, ask user or note in extraction_notes for clarification\n   - PARTNER WORKOUT EXAMPLES:\n     * \"Did a partner WOD with my daughter, 20 rounds alternating\" â†’ rounds_completed: 10 (user's portion)\n     * \"Partner Murph switching every exercise\" â†’ each exercise count Ã· 2 for user\n     * \"We both crushed Fran at the same time\" â†’ full volume for user (synchronized)\n     * \"10 rounds total, I did 5, she did 5\" â†’ rounds_completed: 5 (user's explicit portion)\n\n7. STANDARDIZATION:\n   - Exercise names: Use standard terms (thruster not \"front squat to press\", pull-up not \"chin-up\")\n   - Units: Be consistent (convert if needed, note original)\n   - Times: CRITICAL - ALL time values MUST be in seconds (duration, total_time, round_times, rest_between_sets)\n     * \"8 minutes 57 seconds\" â†’ 537 seconds\n     * \"45 minute workout\" â†’ 2700 seconds\n     * \"1:30 rest\" â†’ 90 seconds\n   - CrossFit Movement Standards: Use official CrossFit terminology (chest-to-bar pull-up, box jump, wall ball, etc.)\n\n7.5. EQUIPMENT TERMINOLOGY INTERPRETATION:\n   - \"Dual DBs\" or \"dual dumbbells\" means using TWO dumbbells simultaneously for ONE movement\n   - Example: \"30 reps dual DBs\" = 30 total reps using two dumbbells at once, NOT 30 reps Ã— 2 dumbbells\n   - \"Single DB\" means using one dumbbell for the movement\n   - \"Alternating\" means switching between arms/sides but count total reps, not per side\n   - \"Each arm\" or \"per arm\" means multiply by 2 (e.g., \"10 reps each arm\" = 20 total reps)\n   - When in doubt about equipment terminology, count the TOTAL movement repetitions performed\n\n7.6. CRITICAL: BILATERAL DUMBBELL WEIGHT CALCULATION:\n   - WEIGHT NOTATION vs REP NOTATION are fundamentally different concepts\n   - WEIGHT NOTATION (\"each hand\", \"per hand\", \"both hands\"):\n     * \"50# each hand\" = 50 pounds PER dumbbell Ã— 2 dumbbells = 100 pounds TOTAL LOAD\n     * \"30kg per hand\" = 30kg PER dumbbell Ã— 2 dumbbells = 60kg TOTAL LOAD\n     * \"both hands\" with bilateral movements = calculate total load across both dumbbells\n     * Record the TOTAL TRAINING LOAD, not per-dumbbell weight\n   - REP NOTATION (\"each arm\", \"per arm\", \"per side\"):\n     * \"10 reps each arm\" = 10 PER arm Ã— 2 arms = 20 total reps\n     * \"15 lunges per side\" = 15 PER side Ã— 2 sides = 30 total reps\n     * Record the TOTAL REPETITIONS performed\n   - BILATERAL DUMBBELL MOVEMENTS requiring total load calculation:\n     * Thrusters, overhead press, bench press, rows, deadlifts, curls, etc.\n     * Any movement where TWO dumbbells are used simultaneously\n   - UNILATERAL MOVEMENTS (keep per-dumbbell weight):\n     * Single-arm rows, single-arm presses, alternating movements\n     * Only use ONE dumbbell at a time\n   - WEIGHT CALCULATION EXAMPLES:\n     * \"4 DB thrusters 50# each hand\" â†’ weight: {value: 100, unit: \"lbs\"} (50Ã—2)\n     * \"DB bench press 30kg per hand\" â†’ weight: {value: 60, unit: \"kg\"} (30Ã—2)\n     * \"Single-arm row 40# each arm\" â†’ weight: {value: 40, unit: \"lbs\"} (unilateral, no doubling)\n     * \"Alternating DB press 25kg\" â†’ weight: {value: 25, unit: \"kg\"} (alternating, no doubling)\n\n8. CROSSFIT EXTRACTION EXAMPLES:\n   - \"Did Fran in 8:57 with 95lb thrusters\" â†’ workout_name: \"Fran\", total_time: 537, rx_status: \"rx\", score: {value: 537, type: \"time\", unit: \"seconds\"}\n   - \"Scaled Murph with 65lb thrusters\" â†’ workout_name: \"Murph\", rx_status: \"scaled\", scaled_weight: 65\n   - \"Today's workout was called Death by Burpees\" â†’ workout_name: \"Death by Burpees\" (preserve user name)\n   - \"I did squats then burpees and pull-ups\" â†’ workout_name: \"Gladiator Complex\" (Latin name for unnamed workout)\n   - \"Completed a strength and conditioning session\" â†’ workout_name: \"Fortis Vigor\" (Latin name for unnamed workout)\n   - \"Did landmine work then front squats and a metcon finisher\" â†’ workout_name: \"Infernus Maximus\" (Latin name for multi-phase workout)\n   - \"Then max strict pull-ups - I got 15\" â†’ reps: {prescribed: \"max\", completed: 15} (use \"max\" not 999)\n   - \"Finished with max push-ups to failure\" â†’ reps: {prescribed: \"max\", completed: [actual number]} (use \"max\" for max effort)\n   - \"20 minute AMRAP: 5 pull-ups, 10 push-ups, 15 squats - got 12 rounds\" â†’ workout_format: \"amrap\", rounds_completed: 12, score: {value: 12, type: \"rounds\"}\n   - \"AMRAP got 12 rounds plus 5 reps\" â†’ rounds_completed: 12, score: {value: \"12+5\", type: \"rounds\"}\n   - \"EMOM 10: 3 thrusters at 135\" â†’ workout_format: \"emom\", time_cap: 600, weight: 135, create 10 separate rounds\n   - \"30min EMOM completed 6 rounds\" â†’ 6 separate round objects in rounds array, NOT 1 template round\n   - \"Broke the 21 thrusters into 10-6-5\" â†’ broken_sets: [10, 6, 5]\n   - \"3 sets of squats at 185, then 5 rounds of burpees and pull-ups\" â†’ workout_format: \"strength_then_metcon\", rounds_completed: 8 (3 squat rounds + 5 metcon rounds)\n   - \"4 DB thrusters 50# each hand\" â†’ weight: {value: 100, unit: \"lbs\"} (bilateral: 50Ã—2=100)\n   - \"DB power cleans 50# both hands\" â†’ weight: {value: 100, unit: \"lbs\"} (bilateral: 50Ã—2=100)\n   - \"Single-arm DB rows 40# each arm\" â†’ weight: {value: 40, unit: \"lbs\"} (unilateral: no doubling)\n\n8.5. OPTIMIZATION EXAMPLES FOR COMPLEX WORKOUTS:\n   - BEFORE: 4 separate warmup rounds (135Ã—3, 185Ã—3, 225Ã—3, 245Ã—3)\n   - AFTER: 1 consolidated round with form_notes: \"Warmup progression: 135Ã—3, 185Ã—3, 225Ã—3, 245Ã—3\"\n   - BEFORE: Full weight objects with all null fields for bodyweight exercises\n   - AFTER: Minimal weight object: {\"value\": null, \"unit\": \"lbs\"}\n   - BEFORE: Detailed form_notes for every similar AMRAP round\n   - AFTER: Brief notes on first round, null for subsequent identical rounds\n\n8.5. POWERLIFTING WARMUP INTERPRETATION EXAMPLES:\n   - LITERAL INTERPRETATION (when explicit language is used):\n     * \"three warm-up sets at 135 pounds 185 pounds 205 pounds each\" = 135Ã—5, 185Ã—5, 205Ã—5 (same reps \"each\")\n     * \"did all my warmups at 5 reps\" = every warmup set gets 5 reps\n     * \"same reps for 135, 185, 205\" = identical rep count across all weights\n     * \"every warmup set was 3 reps\" = uniform 3 reps across all warmup weights\n   - SPORT-SPECIFIC INTERPRETATION (when language is ambiguous):\n     * \"warmed up with 135, 185, 205\" = 135Ã—5, 185Ã—3, 205Ã—1 (typical powerlifting progression)\n     * \"worked up to 225\" = infer standard powerlifting warmup progression\n     * \"three warmup sets before my working sets\" = apply sport-specific rep progression\n   - PRIORITY: Always prioritize literal language over sport conventions\n\n9. CRITICAL: DESCENDING REP SCHEMES (21-15-9) ARE MULTIPLE ROUNDS:\n   - Fran (21-15-9) = 3 SEPARATE ROUNDS, not one round with \"21-15-9\" rep scheme\n   - Round 1: 21 thrusters + 21 pull-ups (prescribed: 21, completed: 21 for each exercise)\n   - Round 2: 15 thrusters + 15 pull-ups (prescribed: 15, completed: 15 for each exercise)\n   - Round 3: 9 thrusters + 9 pull-ups (prescribed: 9, completed: 9 for each exercise)\n   - Same applies to other descending schemes: 15-12-9, 10-8-6, etc.\n   - DO NOT create a single round with rep_scheme \"21-15-9\"\n   - DO create 3 separate rounds with different prescribed rep counts\n\n10. CRITICAL: MULTI-PHASE WORKOUT ROUND STRUCTURING:\n\n   A. STRENGTH_THEN_METCON FORMAT:\n   - Strength phase: Each exercise (or exercise group) = separate round(s)\n   - Metcon phase: Each repetition of the circuit = separate round\n   - IMPORTANT: Keep JSON structure manageable - group similar sets when possible\n   - Example: \"3 sets of squats, 3 sets of bench, then 6 rounds of row+KB swings\"\n     * Round 1: Squat set 1, Round 2: Squat set 2, Round 3: Squat set 3\n     * Round 4: Bench set 1, Round 5: Bench set 2, Round 6: Bench set 3\n     * Round 7: Row+KB round 1, Round 8: Row+KB round 2, ... Round 12: Row+KB round 6\n   - For warmup progressions, you MAY group similar sets to reduce JSON complexity\n\n   B. REPEATED CIRCUIT ROUNDS:\n   - \"6 rounds of X\" = 6 separate rounds, each with round_number incremented\n   - Each round contains the same exercises with same prescribed reps\n   - Track rest periods between rounds in rest_between_sets\n\n   B.1. EMOM SPECIFIC ROUND STRUCTURE:\n   - CRITICAL: EMOM workouts MUST create separate rounds for each COMPLETED ROUND, not each minute\n   - \"30min EMOM\" with 6 rounds completed = 6 separate round objects (NOT 1 template round)\n   - Each round represents one complete cycle through all exercises with incremented round_number: 1, 2, 3, 4, 5, 6\n   - This enables tracking performance degradation, pacing, and round-by-round analysis\n   - WRONG: 1 round with exercises, performance_data.rounds_completed: 6\n   - CORRECT: 6 rounds array elements, each with same exercises, performance_data.rounds_completed: 6\n   - Example: \"30min EMOM, 5 exercises per round, completed 6 rounds\" = create 6 round objects, NOT 30\n\n   C. WORKING SETS vs BURNOUT SETS:\n   - Multiple working sets of same exercise = separate rounds\n   - Burnout sets = separate round with variation: \"burnout\"\n   - Example: \"3 working sets of 5 reps at 175lbs, then burnout set of 12 reps at 135lbs\"\n     * Round 1: 175lbs x 5, Round 2: 175lbs x 5, Round 3: 175lbs x 5, Round 4: 135lbs x 12 (burnout)\n\n   D. WARMUP vs WORKING SETS:\n   - Warmup sets: Can be grouped or separate rounds (use judgment based on detail provided)\n   - Working sets: Always separate rounds for proper progression tracking\n\n   E. DETAILED STRENGTH_THEN_METCON EXAMPLE:\n   User says: \"I did front squats with 3 working sets at 5 reps each at 175 pounds, then a burnout set with 135 pounds for 12 reps. Then I did bench press with 3 working sets of 225 pounds, then a burnout set of 175 pounds at 10 reps. Then I did the Metcon where I rowed and did kettlebell swings for 6 rounds. I rowed for 250m and then 15 American kettlebell swings at 55 pounds with 90 seconds rest between rounds.\"\n\n   CORRECT STRUCTURE:\n   - Round 1: Front squat 175lbs x 5 (working set 1)\n   - Round 2: Front squat 175lbs x 5 (working set 2)\n   - Round 3: Front squat 175lbs x 5 (working set 3)\n   - Round 4: Front squat 135lbs x 12 (burnout set, variation: \"burnout\")\n   - Round 5: Bench press 225lbs x 5 (working set 1)\n   - Round 6: Bench press 225lbs x 5 (working set 2)\n   - Round 7: Bench press 225lbs x 5 (working set 3)\n   - Round 8: Bench press 175lbs x 10 (burnout set, variation: \"burnout\")\n   - Round 9: Row 250m + KB swings 15 reps (metcon round 1, rest: 90 seconds)\n   - Round 10: Row 250m + KB swings 15 reps (metcon round 2, rest: 90 seconds)\n   - Round 11: Row 250m + KB swings 15 reps (metcon round 3, rest: 90 seconds)\n   - Round 12: Row 250m + KB swings 15 reps (metcon round 4, rest: 90 seconds)\n   - Round 13: Row 250m + KB swings 15 reps (metcon round 5, rest: 90 seconds)\n   - Round 14: Row 250m + KB swings 15 reps (metcon round 6, no rest after final round)\n\n   Total rounds_completed: 14\n\n   F. PERFORMANCE_DATA FOR MULTI-PHASE WORKOUTS:\n   - total_time: Overall workout duration (strength + metcon combined)\n   - rounds_completed: Total number of rounds across ALL phases\n   - total_reps: Sum of all reps from all exercises (optional, calculate if clear)\n   - round_times: Only applicable for timed rounds (usually metcon portion)\n\n   G. JSON SIZE OPTIMIZATION STRATEGIES:\n   - WARMUP CONSOLIDATION: Group warmup sets into single rounds with progression notes\n   - OMIT REDUNDANT NULLS: Only include null fields that are contextually important\n   - CONCISE FORM NOTES: Use brief, descriptive notes rather than verbose explanations\n   - METCON EFFICIENCY: For repeated AMRAP rounds, use round_number progression but avoid duplicate exercise details\n   - WEIGHT OBJECTS: Only include relevant weight fields (omit rx_weight/scaled_weight if not applicable)\n   - MINIMAL NESTED OBJECTS: Flatten structures where possible without losing data integrity\n   - STRENGTH+METCON OPTIMIZATION: For \"strength then metcon\" format, consolidate warmup progression into 1-2 rounds max\n\n\nEXTRACTION CONTEXT:\nYou must extract data into this exact JSON structure. Use null for missing data, never omit fields.\n\nCRITICAL EFFICIENCY RULE: For workouts with >8 rounds, apply aggressive consolidation:\n- Consolidate warmup progressions into 1-2 rounds maximum\n- Use concise form_notes to capture progression details\n- Omit null fields that don't add contextual value\n- Prioritize working sets and metcon rounds for individual tracking\n\nANTI-MALFORMED JSON STRATEGY:\n- For workouts with >15 rounds, prioritize JSON structural integrity over complete detail\n- Consider grouping similar consecutive rounds into single rounds with range notation\n- Example: Instead of 8 separate identical warmup rounds, use 1 round with form_notes: \"Rounds 1-8: 135lbs x 3 reps progression\"\n- Better to have valid parseable JSON with some detail loss than malformed JSON with full detail\n- Focus on: working sets, key lifts, metcon rounds - these are most important for tracking\n\nUNIVERSAL WORKOUT SCHEMA STRUCTURE:\n{\n  \"workout_id\": \"string\",\n  \"user_id\": \"string\",\n  \"date\": \"YYYY-MM-DD\",\n  \"discipline\": \"crossfit|powerlifting|bodybuilding|hiit|running|swimming|cycling|yoga|martial_arts|climbing|hybrid\",\n  \"methodology\": \"string|null\",\n  \"workout_name\": \"string|null\",\n  \"workout_type\": \"strength|cardio|flexibility|skill|competition|recovery|hybrid\",\n  \"duration\": \"number|null\",\n  \"location\": \"gym|box|home|outdoors|online|other\",\n  \"coach_id\": \"string|null\",\n  \"conversation_id\": \"string|null\",\n\n  \"performance_metrics\": {\n    \"intensity\": \"number[1-10]|null\",\n    \"perceived_exertion\": \"number[1-10]|null\",\n    \"heart_rate\": {\n      \"avg\": \"number|null\",\n      \"max\": \"number|null\",\n      \"zones\": {\n        \"zone_1\": \"number|null\",\n        \"zone_2\": \"number|null\",\n        \"zone_3\": \"number|null\",\n        \"zone_4\": \"number|null\",\n        \"zone_5\": \"number|null\"\n      }\n    },\n    \"calories_burned\": \"number|null\",\n    \"mood_pre\": \"number[1-10]|null\",\n    \"mood_post\": \"number[1-10]|null\",\n    \"energy_level_pre\": \"number[1-10]|null\",\n    \"energy_level_post\": \"number[1-10]|null\"\n  },\n\n  \"discipline_specific\": {\n    \"crossfit\": {\n      \"workout_format\": \"for_time|amrap|emom|tabata|ladder|chipper|death_by|intervals|strength_then_metcon|hero_workout|custom\",\n      \"time_cap\": \"number|null\",\n      \"rx_status\": \"rx|scaled|modified\",\n      \"rounds\": [\n        {\n          \"round_number\": \"number\",\n          \"rep_scheme\": \"string|null\",\n          \"exercises\": [\n            {\n              \"exercise_name\": \"string\",\n              \"movement_type\": \"barbell|dumbbell|kettlebell|bodyweight|gymnastics|cardio|other\",\n              \"variation\": \"string|null\",\n              \"assistance\": \"string|null\",\n              \"weight\": {\n                \"value\": \"number|null\",\n                \"unit\": \"lbs|kg\",\n                \"percentage_1rm\": \"number|null\",\n                \"rx_weight\": \"number|null\",\n                \"scaled_weight\": \"number|null\"\n              },\n              \"reps\": {\n                \"prescribed\": \"number|string\",\n                \"completed\": \"number\",\n                \"broken_sets\": \"array|null\",\n                \"rest_between_sets\": \"array|null\"\n              },\n              \"distance\": \"number|null\",\n              \"calories\": \"number|null\",\n              \"time\": \"number|null\",\n              \"form_notes\": \"string|null\"\n            }\n          ]\n        }\n      ],\n      \"performance_data\": {\n        \"total_time\": \"number|null\",\n        \"rounds_completed\": \"number\",\n        \"total_reps\": \"number|null\",\n        \"round_times\": \"array|null\",\n        \"score\": {\n          \"value\": \"number|string\",\n          \"type\": \"time|rounds|reps|weight|distance|points\",\n          \"unit\": \"string|null\"\n        }\n      }\n    },\n    \"powerlifting\": {\n      \"session_type\": \"max_effort|dynamic_effort|repetition_method|competition_prep\",\n      \"competition_prep\": \"boolean\",\n      \"exercises\": [\n        {\n          \"exercise_name\": \"string\",\n          \"movement_category\": \"main_lift|accessory|mobility\",\n          \"equipment\": \"array of strings (belt, sleeves, wraps, etc.)\",\n          \"competition_commands\": \"boolean\",\n          \"attempts\": {\n            \"opener\": \"number|null\",\n            \"second_attempt\": \"number|null\",\n            \"third_attempt\": \"number|null\",\n            \"successful_attempts\": \"array of numbers\",\n            \"missed_attempts\": \"array of numbers\",\n            \"miss_reasons\": \"array of strings\"\n          },\n          \"sets\": [\n            {\n              \"set_type\": \"opener|second|third|warmup|working|accessory\",\n              \"weight\": \"number\",\n              \"reps\": \"number\",\n              \"rpe\": \"number 1-10|null\",\n              \"rest_time\": \"number (seconds)|null\",\n              \"percentage_1rm\": \"number|null\",\n              \"bar_speed\": \"slow|moderate|fast|explosive|null\",\n              \"competition_commands\": \"boolean\"\n            }\n          ]\n        }\n      ]\n    },\n    \"bodybuilding\": {},\n    \"hiit\": {},\n    \"running\": {\n      \"run_type\": \"easy|tempo|interval|long|race|recovery|fartlek|progression|threshold|hill_repeats|speed_work\",\n      \"total_distance\": \"number (miles or km)\",\n      \"distance_unit\": \"miles|km\",\n      \"total_time\": \"number (seconds)\",\n      \"average_pace\": \"string (MM:SS format)\",\n      \"elevation_gain\": \"number (feet or meters)|null\",\n      \"elevation_loss\": \"number (feet or meters)|null\",\n      \"surface\": \"road|trail|track|treadmill|mixed\",\n      \"weather\": {\n        \"temperature\": \"number (fahrenheit or celsius)|null\",\n        \"temperature_unit\": \"F|C|null\",\n        \"conditions\": \"sunny|cloudy|rainy|snowy|windy|foggy|null\",\n        \"wind_speed\": \"number (mph or km/h)|null\",\n        \"humidity\": \"number (percent)|null\"\n      },\n      \"equipment\": {\n        \"shoes\": \"string|null\",\n        \"wearable\": \"string|null\",\n        \"other_gear\": \"array|null\"\n      },\n      \"warmup\": {\n        \"distance\": \"number|null\",\n        \"time\": \"number (seconds)|null\",\n        \"description\": \"string|null\"\n      },\n      \"cooldown\": {\n        \"distance\": \"number|null\",\n        \"time\": \"number (seconds)|null\",\n        \"description\": \"string|null\"\n      },\n      \"segments\": [\n        {\n          \"segment_number\": \"integer\",\n          \"segment_type\": \"warmup|working|interval|recovery|cooldown|main\",\n          \"distance\": \"number\",\n          \"time\": \"number (seconds)\",\n          \"pace\": \"string (MM:SS)\",\n          \"heart_rate_avg\": \"number|null\",\n          \"heart_rate_max\": \"number|null\",\n          \"cadence\": \"number (steps per minute)|null\",\n          \"effort_level\": \"easy|moderate|hard|max\",\n          \"terrain\": \"flat|uphill|downhill|mixed\",\n          \"elevation_change\": \"number (feet or meters)|null\",\n          \"notes\": \"string|null\"\n        }\n      ],\n      \"route\": {\n        \"name\": \"string|null\",\n        \"description\": \"string|null\",\n        \"type\": \"out_and_back|loop|point_to_point|null\"\n      },\n      \"fueling\": {\n        \"pre_run\": \"string|null\",\n        \"during_run\": \"array|null\",\n        \"hydration_oz\": \"number|null\"\n      }\n    }\n  },\n\n  \"pr_achievements\": [\n    {\n      \"exercise\": \"string\",\n      \"discipline\": \"string\",\n      \"pr_type\": \"workout_time|1rm|volume_pr|distance_pr|pace_pr\",\n      \"previous_best\": \"number|null\",\n      \"new_best\": \"number\",\n      \"improvement\": \"number|null\",\n      \"improvement_percentage\": \"number|null\",\n      \"date_previous\": \"YYYY-MM-DD|null\",\n      \"significance\": \"minor|moderate|major\",\n      \"context\": \"string|null\"\n    }\n  ],\n\n  \"subjective_feedback\": {\n    \"enjoyment\": \"number[1-10]|null\",\n    \"difficulty\": \"number[1-10]|null\",\n    \"form_quality\": \"number[1-10]|null\",\n    \"motivation\": \"number[1-10]|null\",\n    \"confidence\": \"number[1-10]|null\",\n    \"mental_state\": \"focused|distracted|motivated|tired|energetic|stressed|calm|null\",\n    \"pacing_strategy\": \"even_split|negative_split|positive_split|went_out_too_fast|conservative|null\",\n    \"nutrition_pre_workout\": \"string|null\",\n    \"hydration_level\": \"poor|fair|good|excellent|null\",\n    \"sleep_quality_previous\": \"number[1-10]|null\",\n    \"stress_level\": \"number[1-10]|null\",\n    \"soreness_pre\": {\n      \"overall\": \"number[1-10]|null\",\n      \"legs\": \"number[1-10]|null\",\n      \"arms\": \"number[1-10]|null\",\n      \"back\": \"number[1-10]|null\"\n    },\n    \"soreness_post\": {\n      \"overall\": \"number[1-10]|null\",\n      \"legs\": \"number[1-10]|null\",\n      \"arms\": \"number[1-10]|null\",\n      \"back\": \"number[1-10]|null\"\n    },\n    \"notes\": \"string|null\"\n  },\n\n  \"environmental_factors\": {\n    \"temperature\": \"number|null\",\n    \"humidity\": \"number|null\",\n    \"altitude\": \"number|null\",\n    \"equipment_condition\": \"poor|fair|good|excellent|null\",\n    \"gym_crowding\": \"empty|light|moderate|busy|packed|null\"\n  },\n\n  \"recovery_metrics\": {\n    \"hrv_morning\": \"number|null\",\n    \"resting_heart_rate\": \"number|null\",\n    \"sleep_hours\": \"number|null\",\n    \"stress_level\": \"number[1-10]|null\",\n    \"readiness_score\": \"number[1-10]|null\"\n  },\n\n  \"coach_notes\": {\n    \"programming_intent\": \"string|null\",\n    \"coaching_cues_given\": \"array|null\",\n    \"areas_for_improvement\": \"array|null\",\n    \"positive_observations\": \"array|null\",\n    \"next_session_focus\": \"string|null\",\n    \"adaptation_recommendations\": \"array|null\",\n    \"safety_flags\": \"array\",\n    \"motivation_strategy\": \"string|null\"\n  },\n\n  \"metadata\": {\n    \"logged_via\": \"conversation|app|wearable|manual\",\n    \"logging_time\": \"number|null\",\n    \"data_confidence\": \"number[0-1]\",\n    \"ai_extracted\": \"boolean\",\n    \"user_verified\": \"boolean\",\n    \"version\": \"string\",\n    \"schema_version\": \"2.0\",\n    \"data_completeness\": \"number[0-1]\",\n    \"extraction_method\": \"claude_conversation_analysis|manual_entry|api_import\",\n    \"validation_flags\": \"array\",\n    \"extraction_notes\": \"string|null\"\n  }\n}\n"
}